= Configure Backup and Restore for Anypoint Private Cloud
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

== To Uninstall Anypoint Monitoring
Run the following script

----
# Delete Everything for ${COMPONENT}
COMPONENTS=( dias ) # Add more components to this list, separated by space
for COMPONENT in ${${COMPONENT}[@]}; do
  # Delete HELM Charts
  helm ls --all | grep ${COMPONENT}
  helm delete --purge $(helm ls --all | grep ${COMPONENT} | awk -F' ' '{print $1}')
  sleep 10
  # Delete JOBS
  kubectl get jobs -n ${COMPONENT}
  kubectl delete jobs -n ${COMPONENT} $(kubectl get jobs -n ${COMPONENT} | awk -F' ' '{print $1}')
  kubectl get jobs -n ${COMPONENT}
  sleep 10
  # Delete PVCs
  kubectl get pvc -n ${COMPONENT}
  kubectl delete pvc -n ${COMPONENT} $(kubectl get pvc -n ${COMPONENT} | awk -F' ' '{print $1}') --force --grace-period 0
  kubectl get pvc -n ${COMPONENT}
  sleep 10
  # Delete all DIAS pods
  kubectl delete ${COMPONENT} -n dias $(kubectl get pods -n ${COMPONENT} | awk -F" " '{print $1}') --force --grace-period 0
  kubectl get all -n ${COMPONENT}
  sleep 10
  # Delete all DIAS secrets
  # DONOT delete cluster-ca, cluster-default-ssl!!!!
  kubectl get secrets -n ${COMPONENT}
  kubectl delete secrets -n ${COMPONENT} $(kubectl get secrets -n ${COMPONENT} | grep ${COMPONENT} | awk -F' ' '{print $1}')
  if [[ ${COMPONENT} == 'dias' ]]; then
    kubectl delete secret -n dias influxdb-shared-secret insight-ca insight-cassandra-certs
  fi
  kubectl get secrets -n ${COMPONENT}
  sleep 10
done
----


Once run, validate that the pods in the namespace are gone

----
kubectl get pods -n dias
----


There may be Persistent Volumes and Persistent Volume Claims remaining:

----
kubectl get pvc -n dias
kubectl get pv | grep dias
----


If after 10 mins after deleting the helm charts the volumes still exist then need to delete them manually
To delete Persistent Volumes:

----
kubectl delete pv $(kubectl get pv | grep "dias" | awk -F" " '{print $1}')
----


To delete Persistent Volume Claims:

----
kubectl delete pvc $(kubectl get pvc -n dias | awk -F" " '{print $1}') -n dias
----
